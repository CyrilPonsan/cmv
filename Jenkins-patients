pipeline {
    agent any
    
    tools {
        nodejs 'nodejs'
    }
    
    environment {
        DOCKERHUB_CREDENTIALS = credentials('dockerhub-credentials')
        IMAGE_GATEWAY = "firizgoude/cmv_gateway"
        IMAGE_TAG = "gateway-${env.BUILD_NUMBER}"
        NPM_CACHE_DIR = "tmp/npm-cache"
        BRANCH_NAME = "${env.GIT_BRANCH.split('/').last()}"
        EC2_SERVER = credentials("cmv_host")
        EC2_USER = credentials("cmv_username")
        SSH_CREDENTIALS = credentials('cmv-ssh-key')
    }
    
    stages {
        stage("Checkout") {
            steps {
                checkout scm
                script {
                    echo "Current branch is ${BRANCH_NAME}"
                }
            }
        }
        
        stage("API Patients") {
            steps {
                echo "Working on Patients API"
            }
        }
    }
    
    post {
        always {
            sh 'docker logout'
        }
        success {
            echo 'Pipeline completed successfully!'
        }
        failure {
            echo 'Pipeline failed. Please check the logs.'
        }
    }
}